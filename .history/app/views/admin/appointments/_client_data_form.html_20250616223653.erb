<%= turbo_frame_tag "client_data_frame" do %>
  <%= form_with model: appointment,
                url: admin_appointments_path(format: :turbo_stream),
                method: :post,
                local: false,
                data: { controller: "recaptcha",
                        action:     "submit->recaptcha#submit",
                        recaptcha_site_key: ENV['RECAPTCHA_SITE_KEY'],
                        turbo_frame: "client_data_frame" },
                class: "space-y-6",
                id:    "appointment-form" do |form| %>

    <!-- Carry forward context -->
    <%= form.hidden_field :package_id,      value: package.id %>
    <%= form.hidden_field :doctor_id,       value: doctor_id %>
    <%= form.hidden_field :appointment_date, value: appointment_date %>
    <%= form.hidden_field :time_slot,        value: time_slot %>

    <!-- Name -->
    <div>
      <%= form.label :name,  "Nombre",
                     class: "block text-lg font-medium text-gray-700 mb-2" %>
      <%= form.text_field :name, required: true,
                         class: "block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" %>
    </div>

    <!-- Age -->
    <div>
      <%= form.label :age,   "Edad",
                     class: "block text-lg font-medium text-gray-700 mb-2" %>
      <%= form.number_field :age, required: true,
                           class: "block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" %>
    </div>

    <!-- Phone -->
    <div>
      <%= form.label :phone, "Número de Teléfono",
                     class: "block text-lg font-medium text-gray-700 mb-2" %>
      <%= form.telephone_field :phone, required: true,
                               class: "block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" %>
    </div>

    <!-- reCAPTCHA Token -->
    <%= form.hidden_field :recaptcha_token, id: "recaptcha_token",
                         data: { recaptcha_target: "recaptchaToken" } %>

    <!-- Submit Button -->
    <div class="actions">
      <%= form.submit "Agendar Cita",
                      class: "bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors duration-200" %>
    </div>
  <% end %>
<% end %>
