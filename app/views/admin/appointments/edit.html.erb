<div class="container mx-auto px-4 py-8 max-w-3xl">
  <h1 class="text-3xl font-bold mb-6 text-center">Editar Cita</h1>

  <%= form_with(model: [:admin, @appointment], method: :patch, local: true, class: "space-y-6") do |form| %>

    <!-- Información (solo lectura) -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-white p-4 rounded-md border">
      <div>
        <p class="text-sm text-gray-500">Nombre</p>
        <p class="text-gray-900 font-medium"><%= @appointment.name %></p>
      </div>

      <div>
        <p class="text-sm text-gray-500">Doctor</p>
        <p class="text-gray-900 font-medium"><%= @appointment.doctor&.name || "N/A" %></p>
      </div>

      <div>
        <p class="text-sm text-gray-500">Paquete</p>
        <p class="text-gray-900 font-medium"><%= @appointment.package&.name || "N/A" %></p>
      </div>

      <div>
        <p class="text-sm text-gray-500">Fecha / Hora</p>
        <p class="text-gray-900 font-medium">
          <%= I18n.l(@appointment.start_date.in_time_zone("America/Mexico_City"), format: :custom, locale: :es) rescue "N/A" %>
        </p>
      </div>

      <div>
        <p class="text-sm text-gray-500">Código único</p>
        <p class="text-gray-900 font-medium"><%= @appointment.unique_code %></p>
      </div>

      <div>
        <p class="text-sm text-gray-500">Teléfono</p>
        <p class="text-gray-900 font-medium"><%= @appointment.phone %></p>
      </div>
    </div>

    <!-- ÚNICO campo editable: Estado -->
    <div>
      <%= form.label :status, "Estado", class: "block text-lg font-medium mb-1" %>

      <% allowed_statuses = {
           "completed" => "Completada",
           "canceled_by_admin" => "Cancelada por Admin"
         } %>

      <%= form.select :status,
            options_for_select(
              allowed_statuses.map { |value, label| [label, value] },
              params[:appointment].try(:[], :status) || @appointment.status
            ),
            { prompt: "Selecciona un estado" },
            class: "w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" %>
      <p class="mt-2 text-sm text-gray-500">
        Para cambiar otros datos, cancela esta cita y crea una nueva.
      </p>
    </div>

    <!-- Guardar -->
    <div>
      <%= form.submit "Guardar Cambios",
            class: "w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors duration-200" %>
    </div>
  <% end %>

  <div class="mt-6 text-center">
    <%= link_to "Regresar a Citas", admin_appointments_path, class: "text-blue-600 hover:underline" %>
  </div>
</div>
